<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Rolespace two column view" 
                author_email="evgeny.bogdanov@epfl.ch" 
                author="Evgeny Bogdanov" 
                description="This is a functional skin gadget. It takes all widgets from a space and shows them in a grid layout: two column view. At the moment, it works only in Graasp - http://graasp.epfl.ch">
    <!-- <Require feature="opensocial-0.9" />
    <Require feature="osapi" /> -->
    <Require feature="dynamic-height" />
    <!-- <Require feature="shindig-container" /> -->
    <!-- <Require feature="gadgetcontainer" /> -->
  </ModulePrefs>
  <Content type="html"><![CDATA[

<style type="text/css">
  .gadgets-gadget{width: 100%;}
  body{overflow: auto;}
</style>
  
  <div id="left" style="width: 50%; position: relative; float: left; top: 0px;"></div>
  <div id="right" style="width: 50%; position: relative; float: left; top: 0px;"></div>

<script type="text/javascript" src="http://d2hv4ldeur9lfv.cloudfront.net/opensocial-jquery-1.3.2.5.min.js"></script>
<script type="text/javascript" src="http://shindig.epfl.ch/gadgets/js/shindig-container:rpc.js?c=1&debug=1&nocache=1"></script>

<script type="text/javascript">
var isOwner = false;
var my = {};

// gets the data and calls build for container
  var initialize = function() {

  // This container lays out and renders gadgets itself.

  my.LayoutManager = function() {
    shindig.LayoutManager.call(this);
  };

  my.LayoutManager.inherits(shindig.LayoutManager);

  my.LayoutManager.prototype.getGadgetChrome = function(gadget) {
    var chromeId = 'gadget-chrome-' + gadget.id;
    return chromeId ? document.getElementById(chromeId) : null;
  };

  shindig.container.layoutManager = new my.LayoutManager();

  var gadgets = [{"appUrl":"http://www.google.com/uds/modules/elements/localsearch/localsearch.xml","id":"66","contextType":"@space","contextId":"291","updated":"2011-03-07T18:06:11.000Z","description":"","objectId":66,"name":"Google Map Search","thumbnailUrl":"http://www.google.com/ig/modules/mapsearch-thm.png","displayName":"Google Map Search","appType":"WidgetGadget","filterCapability":{}},{"appUrl":"http://hosting.gmodules.com/ig/gadgets/file/101524135591064138511/QuickLaTeX103.xml","id":"334","contextType":"@space","contextId":"291","updated":"2011-03-07T18:06:24.000Z","description":"","objectId":334,"name":"Quick LaTeX","thumbnailUrl":"http://upload.wikimedia.org/wikipedia/commons/thumb/9/92/LaTeX_logo.svg/800px-LaTeX_logo.svg.png","displayName":"Quick LaTeX","appType":"WidgetGadget","filterCapability":{}},{"appUrl":"http://www.labpixies.com/campaigns/todo/todo.xml","id":"346","contextType":"@space","contextId":"291","updated":"2011-03-07T18:06:39.000Z","description":"","objectId":346,"name":"horoscope","thumbnailUrl":"http://www.labpixies.com/campaigns/todo/images_shared/thumbnail.jpg","displayName":"horoscope","appType":"WidgetGadget","filterCapability":{}},{"appUrl":"http://www.role-demo.de/languageGadgets/languageResourceBrowser/languageResourceBrowser.xml","id":"634","contextType":"@space","contextId":"291","updated":"2011-03-08T16:44:10.000Z","description":"","objectId":634,"name":"English resource browser","displayName":"English resource browser","appType":"WidgetGadget","filterCapability":{}},{"appUrl":"http://graaasp.epfl.ch/gadget/rolespace/rolespace.xml","id":"652","contextType":"@space","contextId":"291","updated":"2011-03-10T15:07:52.000Z","description":"","objectId":652,"name":"test","displayName":"test","appType":"WidgetGadget","filterCapability":{}}]

  build(gadgets);

  

};

// build the container with gadgets
var build = function(my_gadgets){

  var left = document.getElementById('left');
  var right = document.getElementById('right');
  for (var i = 0; i < my_gadgets.length; i++) {
    var gadget_data = my_gadgets[i];
   
    //only show opensocial gadgets
    if(gadget_data.appType != "WidgetGadget")
      continue;
    
    var gadget = shindig.container.createGadget(
        {specUrl: gadget_data.appUrl, height: '400px'});
        
    gadget.setServerBase("http://shindig.epfl.ch/gadgets/");

    shindig.container.addGadget(gadget);
    
    var gadget_el = document.createElement('div');
    gadget_el.id = 'gadget-chrome-'+(gadget.id);
    gadget_el.setAttribute('class','gadget');
    if(i % 2 == 0){
      left.appendChild(gadget_el);    
    }else{
      right.appendChild(gadget_el);
    }
        

    shindig.container.setView("home");
    shindig.container.setParentUrl("http://"+location.host);
    shindig.container.renderGadget(gadget);
  }
  
  // resize the gadget
  gadgets.window.adjustHeight();

};

</script>

<script type="text/javascript">
gadgets.util.registerOnLoadHandler(initialize);
</script>

  ]]></Content>
</Module>
