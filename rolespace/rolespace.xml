<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title="Rolespace two column view" 
                author_email="evgeny.bogdanov@epfl.ch" 
                author="Evgeny Bogdanov" 
                description="This is a functional skin gadget. It takes all widgets from a space and shows them in a grid layout: two column view. At the moment, it works only in Graasp - http://graasp.epfl.ch">
    <!-- <Require feature="opensocial-0.9" />
    <Require feature="osapi" /> -->
    <Require feature="dynamic-height" />
    <Require feature="shindig-container" />
    <!-- <Require feature="gadgetcontainer" /> -->
  </ModulePrefs>
  <Content type="html"><![CDATA[

<style type="text/css">
  .gadgets-gadget{width: 100%;}
  body{overflow: auto;}
  .gadget{margin: 10px; border: 1px solid #87AFDA; border-radius: 5px; -moz-border-radius:5px; color: #36C;}
  .gadgets-gadget-title-bar{padding:5px; border-bottom: 1px solid #87AFDA; background-color: #D4E6FC;
    border-top-left-radius: 5px;
    border-top-right-radius: 5px;
    -moz-border-radius-topleft: 5px;
    -moz-border-radius-topright: 5px;
    }
  .gadgets-gadget-content{padding:5px; 
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
  -moz-border-radius-bottomleft: 5px;
  -moz-border-radius-bottomright: 5px;
  }
</style>
  
  <div id="left" style="width: 50%; position: relative; float: left; top: 0px;"></div>
  <div id="right" style="width: 50%; position: relative; float: left; top: 0px;"></div>

<script type="text/javascript" src="http://d2hv4ldeur9lfv.cloudfront.net/opensocial-jquery-1.3.2.5.min.js"></script>
<!-- <script type="text/javascript" src="http://graaasp.epfl.ch/gadgets/js/shindig-container:rpc.js?c=1&debug=1&nocache=1"></script> -->

<script type="text/javascript">
var isOwner = false;
var my = {};

// gets the data and calls build for container
  var initialize = function() {

  // This container lays out and renders gadgets itself.

  my.LayoutManager = function() {
    shindig.LayoutManager.call(this);
  };

  my.LayoutManager.inherits(shindig.LayoutManager);

  my.LayoutManager.prototype.getGadgetChrome = function(gadget) {
    var chromeId = 'gadget-chrome-' + gadget.id;
    return chromeId ? document.getElementById(chromeId) : null;
  };

  shindig.container.layoutManager = new my.LayoutManager();

  osapi.context.get().execute(function(response){
    osapi.apps.get({contextId: response.contextId, contextType: response.contextType}).execute(function(response){
      //console.log(response);
      build(response.list);
    });

  });

  

};

// build the container with gadgets
var build = function(my_gadgets){

  var left = document.getElementById('left');
  var right = document.getElementById('right');
  
  if(my_gadgets.length == 0){
    left.innerHTML = "No gadgets were found!"
  }
  
  for (var i = 0; i < my_gadgets.length; i++) {
    var gadget_data = my_gadgets[i];
   
    //only show opensocial gadgets
    if(gadget_data.appType != "WidgetGadget")
      continue;
        
    var gadget = shindig.container.createGadget(
        {specUrl: gadget_data.appUrl, height: '400px', title: gadget_data.displayName});

    shindig.container.addGadget(gadget);
    
    var gadget_el = document.createElement('div');
    gadget_el.id = 'gadget-chrome-'+(gadget.id);
    gadget_el.setAttribute('class','gadget');
    if(i % 2 == 0){
      left.appendChild(gadget_el);    
    }else{
      right.appendChild(gadget_el);
    }
        

    shindig.container.setView("home");
    shindig.container.renderGadget(gadget);
  }
  
  // resize the gadget
  gadgets.window.adjustHeight();

};

</script>

<script type="text/javascript">
gadgets.util.registerOnLoadHandler(initialize);
</script>

  ]]></Content>
</Module>
